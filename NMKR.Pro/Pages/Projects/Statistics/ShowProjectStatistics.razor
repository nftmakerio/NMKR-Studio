@page "/projectstatistics/{projectid:int}"
@inject AppSettings settings
@inject IConnectionMultiplexer _redis;


<BreadCrumb Items="_items"></BreadCrumb>

<MudContainer MaxWidth="MaxWidth.False" Class="mt-4">
    <StatisticsList CustomerId="@settings.UserId" ProjectId="@projectid" Redis="_redis"></StatisticsList>
    <div class="mt-5 mb-5"></div>
    <TransactionList CustomerId="@settings.UserId" ProjectId="@projectid" Redis="_redis" ShowProjectName="false" showDateTimePicker="false"></TransactionList>
</MudContainer>



@code {
    [Parameter]
    public int projectid { get; set; }

    [Inject]
    private IDialogService DialogService { get; set; }

    private readonly List<BreadcrumbItem> _items = new()
    {
        new("Dashboard", href: "/"),
        new("NFT Projects", href: "/projects"),
    };

    private Nftproject project = new();

    protected override async Task OnParametersSetAsync()
    {
        await using var db = new EasynftprojectsContext(GlobalFunctions.optionsBuilder.Options);

        project = await (from a in db.Nftprojects
                         where a.CustomerId == settings.UserId
                               && a.State != "deleted" && a.Id == projectid
                         select a).FirstOrDefaultAsync();

        if (project == null)
            return;

        if (projectid != 0)
            _items.Add(new("Project Statistics (" + project.Projectname + ")", href: "/managenft/" + projectid, disabled: true));
        StateHasChanged();
    }


}
