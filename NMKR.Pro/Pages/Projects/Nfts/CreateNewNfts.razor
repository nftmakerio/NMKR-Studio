@page "/uploadfiles/{projectid:int}"
@inject AppSettings settings
@inject ISnackbar Snackbar
@inject NavigationManager NavigationManager

<BreadCrumb Items="_items"></BreadCrumb>

<MudContainer MaxWidth="MaxWidth.False" Class="mt-4">
  <CreateNft Projectid="@Projectid" CustomerId="(int)settings.UserId"></CreateNft>
</MudContainer>

@code {
    [Parameter]
    public int Projectid { get; set; }

    private readonly List<BreadcrumbItem> _items = new();


    protected override async Task OnParametersSetAsync()
    {
        await using var db = new EasynftprojectsContext(GlobalFunctions.optionsBuilder.Options);
        var project = await (from a in db.Nftprojects
                          where a.Id == Projectid && a.CustomerId == settings.UserId
                          select a).FirstOrDefaultAsync();
        if (project == null)
        {
            LogClass.LogMessage(db,"WARNING: User tried to get Access to a foreign account: " + settings.UserId + " - Project id:"+Projectid);
            Snackbar.Configuration.PositionClass = Defaults.Classes.Position.TopCenter;
            Snackbar.Add("Internal error - please contact support", Severity.Error);
            NavigationManager.NavigateTo("/projects");
            return;
        }

        _items.Add(new("Dashboard", href: "/"));
        _items.Add(new("NFT Projects", href: "/projects"));
        _items.Add(new("Manage NFT (" + project.Projectname + ")", "/managenft/" + Projectid));
        _items.Add(new("Upload Files", href: "/uploadfiles/" + Projectid, disabled: true));
     
    }
}
